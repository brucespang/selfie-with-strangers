---

- name: Install apache
  apt: pkg={{ item }} state=installed
  with_items:
    - apache2

- name: Disable default Apache site
  command: a2dissite 000-default removes=/etc/apache2/sites-enabled/000-default.conf
  notify: restart apache

- name: Enable Apache headers module
  command: a2enmod headers creates=/etc/apache2/mods-enabled/headers.load
  notify: restart apache

- name: Set firewall rules for web traffic
  ufw: rule=allow port={{ item }} proto=tcp
  with_items:
    - http
    - https

- name: Add our packagecloud repository
  script: script.deb creates=/etc/apt/sources.list.d/brucespang_packages.list

- name: install dependencies
  apt: pkg={{ item }} state=present
  with_items:
    - selfiewithstrangers.club
  when: env != 'dev'

- name: install dependencies
  file: src=/vagrant/src/website dest=/var/www/selfiewithstrangers.club state=link
  when: env == 'dev'

- name: configure apache for selfiewithstrangers.club
  template: src=etc_apache2_sites-available_selfiewithstrangers.club.j2 dest=/etc/apache2/sites-available/selfiewithstrangers.club.conf group=root owner=root

- name: enable selfiewithstrangers.club
  command: a2ensite selfiewithstrangers.club.conf creates=/etc/apache2/sites-enabled/selfiewithstrangers.club.conf
  notify: restart apache